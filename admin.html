<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Admin - Rastreador de Localização</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f2f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #3b9b72;
        }
        #map {
            height: 400px;
            margin-bottom: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: left;
        }
        th {
            background-color: #3b9b72;
            color: white;
        }
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Painel Admin - Rastreador de Localização</h1>
        <div id="map"></div>
        <table id="locationTable">
            <thead>
                <tr>
                    <th>Latitude</th>
                    <th>Longitude</th>
                    <th>Precisão (m)</th>
                    <th>Timestamp</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <script>
        var map = L.map('map').setView([0, 0], 2);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap contributors'
        }).addTo(map);

        function updateMap(locations) {
            map.eachLayer((layer) => {
                if (layer instanceof L.Marker || layer instanceof L.Circle) {
                    map.removeLayer(layer);
                }
            });

            locations.forEach((location) => {
                const marker = L.marker([location.latitude, location.longitude]).addTo(map);
                marker.bindPopup(`Lat: ${location.latitude.toFixed(6)}, Lon: ${location.longitude.toFixed(6)}<br>Precisão: ${location.accuracy.toFixed(2)}m<br>Hora: ${new Date(location.timestamp).toLocaleString()}`);

                L.circle([location.latitude, location.longitude], {
                    color: 'red',
                    fillColor: '#f03',
                    fillOpacity: 0.2,
                    radius: location.accuracy
                }).addTo(map);
            });

            if (locations.length > 0) {
                const bounds = L.latLngBounds(locations.map(loc => [loc.latitude, loc.longitude]));
                map.fitBounds(bounds);
            }
        }

        function updateTable(locations) {
            const tableBody = document.querySelector('#locationTable tbody');
            tableBody.innerHTML = '';
            locations.forEach((location) => {
                const row = tableBody.insertRow();
                row.insertCell(0).textContent = location.latitude.toFixed(6);
                row.insertCell(1).textContent = location.longitude.toFixed(6);
                row.insertCell(2).textContent = location.accuracy.toFixed(2);
                row.insertCell(3).textContent = new Date(location.timestamp).toLocaleString();
            });
        }

        function fetchLocations() {
            fetch('/api/locations')
                .then(response => response.json())
                .then(locations => {
                    updateMap(locations);
                    updateTable(locations);
                })
                .catch(error => console.error('Error fetching locations:', error));
        }

        // Fetch locations initially and then every 5 seconds
        fetchLocations();
        setInterval(fetchLocations, 5000);
    </script>
</body>
</html>

